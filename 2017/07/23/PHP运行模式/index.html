<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>PHP运行模式 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前言学习 PHP 运行模式的原因来源于面试中的一个问题：从用户在浏览器中输入网址到接收到返回的页面过程中，发生了什么？">
<meta name="keywords" content="PHP,FastCGI">
<meta property="og:type" content="article">
<meta property="og:title" content="PHP运行模式">
<meta property="og:url" content="http://yoursite.com/2017/07/23/PHP运行模式/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="前言学习 PHP 运行模式的原因来源于面试中的一个问题：从用户在浏览器中输入网址到接收到返回的页面过程中，发生了什么？">
<meta property="og:updated_time" content="2017-07-23T12:46:02.100Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PHP运行模式">
<meta name="twitter:description" content="前言学习 PHP 运行模式的原因来源于面试中的一个问题：从用户在浏览器中输入网址到接收到返回的页面过程中，发生了什么？">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-PHP运行模式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/23/PHP运行模式/" class="article-date">
  <time datetime="2017-07-23T08:43:51.000Z" itemprop="datePublished">2017-07-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      PHP运行模式
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>学习 PHP 运行模式的原因来源于面试中的一个问题：从用户在浏览器中输入网址到接收到返回的页面过程中，发生了什么？</p>
<a id="more"></a>
<p>结果，发现自己对于 PHP 的请求达到服务器并最终解析为 HTML 文件的过程并不熟悉。而这个过程与 PHP 的运行模式有很大的关系，所以就学习了下 PHP 的运行模式。</p>
<p>至于 PHP 请求到达服务器时，发生了什么，可以看我的这篇博客：<a href="">PHP请求到达服务器后经历了什么</a></p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="什么是运行模式"><a href="#什么是运行模式" class="headerlink" title="什么是运行模式"></a>什么是运行模式</h3><p>我们都知道 PHP 脚本要先被解释成 Opcode 再执行，但整个过程并没有这么简单。在处理请求之前，还要解析 php.ini 配置文件，初始化执行环境。然后才开始处理请求，最后用规定的格式返回处理后的结果。完成这些任务的工具被叫做 PHP 解释器。<em>在 Windows 中，PHP 解释器是 php.exe，Linux 中是 /sbin/php</em>。（这里我也不是特别确定）</p>
<p>那么应该什么时候启动这个解释器，以什么方式启动，如果有多个请求到达，怎么分配解释器效果最好？这些就是 PHP 的运行模式要考虑的问题。</p>
<p>总之，PHP 解释器的作用是解析请求，返回结果；PHP 运行模式是管理 PHP 解释器进程的思路。</p>
<h3 id="常见运行模式"><a href="#常见运行模式" class="headerlink" title="常见运行模式"></a>常见运行模式</h3><p>PHP 目前比较常见的五大运行模式如下：</p>
<ol>
<li><p>CGI（通用网关接口 / Common Gateway Interface）</p>
</li>
<li><p>FastCGI（常驻型CGI / Long-Live CGI）</p>
</li>
<li><p>CLI（命令行运行 / Command Line Interface）</p>
</li>
<li><p>Web 模块模式（作为Apache等 Web 服务器的一个模块）</p>
</li>
<li><p>ISAPI（Internet Server Application Program Interface）</p>
</li>
</ol>
<p>注：PHP5.3 以后，PHP 不再有 ISAPI 模式，安装后也不再有 php5isapi.dll 这个文件。要在 IIS6 上使用高版本 PHP，必须安装 FastCGI 扩展，然后使 IIS6 支持 FastCGI。</p>
<h4 id="CGI模式"><a href="#CGI模式" class="headerlink" title="CGI模式"></a>CGI模式</h4><p>CGI 即通用网关接口（Common Gateway Interface），它采用 Fork-And-Execute 模式，每有一个用户请求，都会先要创建 CGI 的子进程，然后解析配置文件，初始化执行环境，并处理请求，处理完后返回结果同时结束这个子进程。</p>
<p><strong>优点：</strong>把 Web Server 和具体的程序处理独立开来，结构清晰，可控性强；CGI 的跨平台性能极佳，几乎可以在任何操作系统上实现；</p>
<p><strong>缺点：</strong>高并发时，会 Fork 出大量的 CGI 子进程，占用太多的系统资源如内存，CPU时间等，造成效能低下。</p>
<h3 id="FastCGI模式"><a href="#FastCGI模式" class="headerlink" title="FastCGI模式"></a>FastCGI模式</h3><p>CGI 模式下，每有一个请求，都要创建一个子进程，并重新解析php.ini、重新载入全部 dll 扩展并重初始化全部数据结构，这就导致了 CGI 模式性能低下。</p>
<p>FastCGI 的出现解决了这个问题，它是 CGI 的升级版本，可以看作是一个常驻（long-live）型的 CGI。它的工作原理如下:</p>
<ol>
<li>在 Web Server 启动时载入 FastCGI 进程管理器（IIS ISAPI 或 Apache FastCGI 模块或 php-fpm)；</li>
<li>FastCGI 进程管理器自身初始化，先启动一个主进程（Master），解析配置文件，初始化执行环境，然后启动多个子进程（worker）并等待来自 Web Server 的连接；</li>
<li>当请求到达 Web Server 时，Master 会选择并连接一个 worker，由 worker 来执行。 Master 可以继续接收下一个请求；</li>
<li>worker 完成处理后将标准输出和错误信息从同一连接返回 Web Server，然后关闭连接，这个请求便处理完成了。</li>
</ol>
<p>另外，master 可以动态地管理 worker 的个数。当 worker 不够用时，可以根据配置预先启动几个等着；当空闲 worker 太多时，也可以停掉一些，这样就提高了性能，也节约了资源。</p>
<h3 id="CLI模式"><a href="#CLI模式" class="headerlink" title="CLI模式"></a>CLI模式</h3><p>CLI 是 Command Line Interface 的简称，就是在命令行运行的接口，它直接调用 PHP 的解释器来执行脚本，进程结束后操作系统负责回收资源。</p>
<p>我们在 Linux 下经常使用的 <code>php –m</code> 查找 PHP 安装了那些扩展就是 PHP 命令行运行模式，其它的还有 <code>php -f</code>、<code>php -r</code>等。</p>
<h3 id="Web模块模式"><a href="#Web模块模式" class="headerlink" title="Web模块模式"></a>Web模块模式</h3><p>Web 模块模式通常用在 Apache 服务器中，是指将 PHP 作为 Apache 的一个模块，在 Apache 启动时加载（或者在运行时动态加载）。</p>
<p>还记得在配置 Apache 时，在 httpd.conf 中添加了这样一行：</p>
<pre><code># Linux
LoadModule php5_module modules/mod_php5.so
# Windows
LoadModule php5_module &quot;php/php5apache2_4.dll&quot;
</code></pre><p>作用就是加载 PHP 处理模块（mod_php5 或 php5apache2_4）。它的作用还是接收 Apache 传递过来的 PHP 文件请求，并处理这些请求，然后将处理后的结果返回给 Apache。它算是 Apache 在 CGI 的基础上的一种扩展，加快了 PHP 的运行效率。</p>
<h3 id="ISAPI模式"><a href="#ISAPI模式" class="headerlink" title="ISAPI模式"></a>ISAPI模式</h3><p>ISAPI（Internet Server Application Program Interface）是微软提供的一套 API 接。一个 ISAPI 的 DLL，可以在被用户请求激活后长驻内存，等待用户的另一个请求，还可以在一个 DLL 里设置多个用户请求处理函数。</p>
<p>ISAPI 的 DLL 应用程序和服务器处于同一个进程中，效率要显著高于 CGI。（由于微软的排它性，只能运行于 Windows 环境）</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.cnblogs.com/xia520pi/p/3914964.html" target="_blank" rel="noopener">PHP运行模式</a></p>
<p><a href="https://segmentfault.com/q/1010000000256516" target="_blank" rel="noopener">搞不清FastCgi与PHP-fpm之间是个什么样的关系</a></p>
<p><a href="http://www.mike.org.cn/articles/what-is-cgi-fastcgi-php-fpm-spawn-fcgi/" target="_blank" rel="noopener">什么是CGI、FastCGI、PHP-CGI、PHP-FPM、Spawn-FCGI？</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/23/PHP运行模式/" data-id="cjee96d34005l5cvn058qezuq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FastCGI/">FastCGI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/">PHP</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/07/24/Nginx配置文件详解/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Nginx配置文件详解
        
      </div>
    </a>
  
  
    <a href="/2017/07/22/PHP的垃圾回收机制/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">PHP的垃圾回收机制</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/PHP内核/">PHP内核</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/基础教程/">基础教程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/基础知识/">基础知识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习笔记/">学习笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/">教程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活杂记/">生活杂记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/科研/">科研</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程基础/">编程基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/课程/">课程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试/">面试</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apache/">Apache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMD/">CMD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Excel/">Excel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FastCGI/">FastCGI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/">Markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Matlab/">Matlab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenCV/">OpenCV</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP求职宝典/">PHP求职宝典</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/R/">R</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RStudio/">RStudio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ThinkPHP/">ThinkPHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/echo/">echo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pcntl/">pcntl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rewrite/">rewrite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sem/">sem</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shmop/">shmop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/信号/">信号</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/信号量/">信号量</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/垃圾回收/">垃圾回收</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/字符编码/">字符编码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/径向基/">径向基</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/排序算法/">排序算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/正则/">正则</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/消息队列/">消息队列</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/爬虫/">爬虫</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/生活/">生活</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/神经网络/">神经网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/管道/">管道</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/缓存/">缓存</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/计算机网络/">计算机网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/进程/">进程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/进程通信/">进程通信</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/进程，线程/">进程，线程</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Apache/" style="font-size: 14.44px;">Apache</a> <a href="/tags/CMD/" style="font-size: 10px;">CMD</a> <a href="/tags/Excel/" style="font-size: 10px;">Excel</a> <a href="/tags/FastCGI/" style="font-size: 10px;">FastCGI</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Linux/" style="font-size: 12.22px;">Linux</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Matlab/" style="font-size: 18.89px;">Matlab</a> <a href="/tags/MySQL/" style="font-size: 16.67px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 14.44px;">Nginx</a> <a href="/tags/OpenCV/" style="font-size: 11.11px;">OpenCV</a> <a href="/tags/PHP/" style="font-size: 20px;">PHP</a> <a href="/tags/PHP求职宝典/" style="font-size: 11.11px;">PHP求职宝典</a> <a href="/tags/R/" style="font-size: 10px;">R</a> <a href="/tags/RStudio/" style="font-size: 10px;">RStudio</a> <a href="/tags/SEO/" style="font-size: 10px;">SEO</a> <a href="/tags/TCP/" style="font-size: 12.22px;">TCP</a> <a href="/tags/ThinkPHP/" style="font-size: 10px;">ThinkPHP</a> <a href="/tags/echo/" style="font-size: 10px;">echo</a> <a href="/tags/pcntl/" style="font-size: 12.22px;">pcntl</a> <a href="/tags/rewrite/" style="font-size: 12.22px;">rewrite</a> <a href="/tags/sem/" style="font-size: 10px;">sem</a> <a href="/tags/shmop/" style="font-size: 10px;">shmop</a> <a href="/tags/socket/" style="font-size: 10px;">socket</a> <a href="/tags/信号/" style="font-size: 10px;">信号</a> <a href="/tags/信号量/" style="font-size: 10px;">信号量</a> <a href="/tags/垃圾回收/" style="font-size: 10px;">垃圾回收</a> <a href="/tags/字符编码/" style="font-size: 12.22px;">字符编码</a> <a href="/tags/径向基/" style="font-size: 11.11px;">径向基</a> <a href="/tags/排序算法/" style="font-size: 15.56px;">排序算法</a> <a href="/tags/正则/" style="font-size: 11.11px;">正则</a> <a href="/tags/消息队列/" style="font-size: 10px;">消息队列</a> <a href="/tags/爬虫/" style="font-size: 10px;">爬虫</a> <a href="/tags/生活/" style="font-size: 10px;">生活</a> <a href="/tags/神经网络/" style="font-size: 17.78px;">神经网络</a> <a href="/tags/算法/" style="font-size: 14.44px;">算法</a> <a href="/tags/管道/" style="font-size: 10px;">管道</a> <a href="/tags/缓存/" style="font-size: 13.33px;">缓存</a> <a href="/tags/计算机网络/" style="font-size: 13.33px;">计算机网络</a> <a href="/tags/设计模式/" style="font-size: 14.44px;">设计模式</a> <a href="/tags/进程/" style="font-size: 12.22px;">进程</a> <a href="/tags/进程通信/" style="font-size: 14.44px;">进程通信</a> <a href="/tags/进程，线程/" style="font-size: 10px;">进程，线程</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/03/04/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2018/01/01/查看系统位数、版本号和内核版本号/">查看系统位数、版本号和内核版本号</a>
          </li>
        
          <li>
            <a href="/2017/10/10/电脑开机时发生了什么？/">电脑开机时发生了什么？</a>
          </li>
        
          <li>
            <a href="/2017/10/01/PHP安全处理字符串/">PHP安全处理字符串</a>
          </li>
        
          <li>
            <a href="/2017/09/28/PHP爬取百度图片/">PHP爬取百度图片</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>